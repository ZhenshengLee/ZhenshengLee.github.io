<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>【ROS】roscommon详解 | 哈骑士的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="[TOC]
前言
ROS，其实从本质上讲就是一个消息通信中间件，其最基础的功能就是在ros_common这个包中实现的，如消息，服务，控制台，roslaunch等等，在这里重点学习几个平时没有用到，但也非常重要的模块">
<meta property="og:type" content="article">
<meta property="og:title" content="【ROS】roscommon详解">
<meta property="og:url" content="https://ZhenshengLee.github.io/2016/08/16/160816-roscommon详解/index.html">
<meta property="og:site_name" content="哈骑士的博客">
<meta property="og:description" content="[TOC]
前言
ROS，其实从本质上讲就是一个消息通信中间件，其最基础的功能就是在ros_common这个包中实现的，如消息，服务，控制台，roslaunch等等，在这里重点学习几个平时没有用到，但也非常重要的模块">
<meta property="og:updated_time" content="2016-08-16T08:26:33.210Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【ROS】roscommon详解">
<meta name="twitter:description" content="[TOC]
前言
ROS，其实从本质上讲就是一个消息通信中间件，其最基础的功能就是在ros_common这个包中实现的，如消息，服务，控制台，roslaunch等等，在这里重点学习几个平时没有用到，但也非常重要的模块">
  
    <link rel="alternative" href="/atom.xml" title="哈骑士的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xvunf.com1.z0.glb.clouddn.com/%E5%85%B6%E4%BB%96320X425.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">黎振胜</a></h1>
		</hgroup>

		
		<p class="header-subtitle">将科技固化为产品——机器人软件开发</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/tags/写在前面/">写在前面</a></li>
				        
							<li><a href="/tags/机器人软件构造/">机器人软件构造</a></li>
				        
							<li><a href="/tags/机器人软件设计/">机器人软件设计</a></li>
				        
							<li><a href="/tags/机器人系统开发/">机器人系统开发</a></li>
				        
							<li><a href="/tags/机械设计/">机械设计</a></li>
				        
							<li><a href="/tags/其他/">其他</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ZhenshengLee" title="github">github</a>
					        
								<a class="mail" target="_blank" href="mailto://lzs_1993@qq.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="https://cn.linkedin.com/in/zhenshengli" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/其他/" style="font-size: 13.33px;">其他</a> <a href="/tags/写在前面/" style="font-size: 10px;">写在前面</a> <a href="/tags/机器人系统开发/" style="font-size: 13.33px;">机器人系统开发</a> <a href="/tags/机器人软件构造/" style="font-size: 16.67px;">机器人软件构造</a> <a href="/tags/机器人软件设计/" style="font-size: 20px;">机器人软件设计</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">机械电子工程在读研究生，从事协作机器人软件开发，正在找工作</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">黎振胜</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xvunf.com1.z0.glb.clouddn.com/%E5%85%B6%E4%BB%96320X425.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">黎振胜</h1>
			</hgroup>
			
			<p class="header-subtitle">将科技固化为产品——机器人软件开发</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/tags/写在前面/">写在前面</a></li>
		        
					<li><a href="/tags/机器人软件构造/">机器人软件构造</a></li>
		        
					<li><a href="/tags/机器人软件设计/">机器人软件设计</a></li>
		        
					<li><a href="/tags/机器人系统开发/">机器人系统开发</a></li>
		        
					<li><a href="/tags/机械设计/">机械设计</a></li>
		        
					<li><a href="/tags/其他/">其他</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ZhenshengLee" title="github">github</a>
			        
						<a class="mail" target="_blank" href="mailto://lzs_1993@qq.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="https://cn.linkedin.com/in/zhenshengli" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-160816-roscommon详解" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/16/160816-roscommon详解/" class="article-date">
  	<time datetime="2016-08-16T08:16:08.000Z" itemprop="datePublished">2016-08-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      【ROS】roscommon详解
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/机器人软件设计/">机器人软件设计</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul>
<li>ROS，其实从本质上讲就是一个消息通信中间件，其最基础的功能就是在ros_common这个包中实现的，如消息，服务，控制台，roslaunch等等，在这里重点学习几个平时没有用到，但也非常重要的模块</li>
</ul>
<a id="more"></a>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://wiki.ros.org/ros_comm?distro=kinetic" target="_blank" rel="external">Wiki Page</a></p>
<h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><h3 id="message-filters"><a href="#message-filters" class="headerlink" title="message_filters"></a><a href="http://wiki.ros.org/message_filters" target="_blank" rel="external">message_filters</a></h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><ul>
<li>集中处理多个消息来源的模块，或者说是进行消息同步的模块<ul>
<li>一个例子是time synchronizer，其将多个输入消息进行“过滤”（例如消息a，b），只输出消息a的timestamp下的b消息，即对消息b中的“无用”消息进行了“过滤”</li>
</ul>
</li>
</ul>
<h4 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造</span></span><br><span class="line">FooFilter foo;</span><br><span class="line"><span class="function">BarFilter <span class="title">bar</span><span class="params">(foo)</span></span>;<span class="comment">//Bar的输入连接着foo的输出</span></span><br><span class="line">bar.connectInput(foo);<span class="comment">//等价</span></span><br><span class="line">bar.registerCallback(myCallback);<span class="comment">//myCallback是一个可调用对象</span></span><br></pre></td></tr></table></figure>
<h4 id="Time-Synchronizer"><a href="#Time-Synchronizer" class="headerlink" title="Time Synchronizer"></a>Time Synchronizer</h4><ul>
<li>The TimeSynchronizer filter synchronizes incoming channels by the timestamps contained in their headers, and outputs them in the form of a single callback that takes the same number of channels. The C++ implementation can synchronize up to 9 channels.<ul>
<li>使用一个回调函数同时处理多个消息，可以按照时间戳将不符合要求的消息丢弃，最多支持9通道，因为c++模板参数最多支持9个</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;message_filters/subscriber.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;message_filters/time_synchronizer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sensor_msgs/Image.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sensor_msgs/CameraInfo.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sensor_msgs;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> message_filters;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callback</span><span class="params">(<span class="keyword">const</span> ImageConstPtr&amp; image, <span class="keyword">const</span> CameraInfoConstPtr&amp; cam_info)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="comment">// Solve all of perception here...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  ros::init(argc, argv, <span class="string">"vision_node"</span>);</span><br><span class="line"></span><br><span class="line">  ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">  message_filters::Subscriber&lt;Image&gt; image_sub(nh, <span class="string">"image"</span>, <span class="number">1</span>);</span><br><span class="line">  message_filters::Subscriber&lt;CameraInfo&gt; info_sub(nh, <span class="string">"camera_info"</span>, <span class="number">1</span>);</span><br><span class="line">  TimeSynchronizer&lt;Image, CameraInfo&gt; sync(image_sub, info_sub, <span class="number">10</span>);</span><br><span class="line">  sync.registerCallback(boost::bind(&amp;callback, _1, _2));</span><br><span class="line"></span><br><span class="line">  ros::spin();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>时间同步器现在还支持时间相近的时间戳的消息聚合处理，见后面的Policy-Based Synchronizer</li>
</ul>
<h4 id="Time-Sequencer"><a href="#Time-Sequencer" class="headerlink" title="Time Sequencer"></a>Time Sequencer</h4><ul>
<li>The TimeSequencer filter guarantees that messages will be called in temporal order according to their header’s timestamp. The TimeSequencer is constructed with a specific delay which specifies how long to queue up messages before passing them through. A callback for a message is never invoked until the messages’ time stamp is out of date by at least delay. However, for all messages which are out of date by at least the delay, their callback are invoked and guaranteed to be in temporal order. If a message arrives from a time prior to a message which has already had its callback invoked, it is thrown away.<ul>
<li>简单讲，使得消息的回调函数调用能够按照固定时间间隔和按先后顺序执行，如果出现顺序混乱，则将此消息丢弃</li>
</ul>
</li>
</ul>
<h4 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h4><ul>
<li>可以存储时间上最近的N个消息</li>
</ul>
<h4 id="Policy-Based-Synchronizer"><a href="#Policy-Based-Synchronizer" class="headerlink" title="Policy-Based Synchronizer"></a>Policy-Based Synchronizer</h4><ul>
<li>基于某种策略的消息同步<ul>
<li>有两种同步：ExactTime和ApproximateTime</li>
</ul>
</li>
</ul>
<h4 id="Chain"><a href="#Chain" class="headerlink" title="Chain"></a>Chain</h4><ul>
<li>可以将Filter连成一个链<ul>
<li>输出与下一个输入相连</li>
</ul>
</li>
</ul>
<h3 id="ros-bag"><a href="#ros-bag" class="headerlink" title="ros_bag"></a><a href="http://wiki.ros.org/rosbag?distro=kinetic" target="_blank" rel="external">ros_bag</a></h3><ul>
<li>记录和重新播放消息数据的工具包，生成一个*.bag文件，此文件可以用Matlab进行解析，也可以在ROS系统中进行重新播放。<ul>
<li>详细情况见我的另外一篇播客</li>
</ul>
</li>
</ul>
<h3 id="ros-graph"><a href="#ros-graph" class="headerlink" title="ros_graph"></a><a href="http://wiki.ros.org/rosgraph?distro=kinetic" target="_blank" rel="external">ros_graph</a></h3><ul>
<li>进行画图的命令行工具包，在终端显示数据等</li>
<li>使用python命令更好，包括：rostopic, rosnode, rosservice, rosparam</li>
</ul>
<h3 id="XmlRpc"><a href="#XmlRpc" class="headerlink" title="XmlRpc++"></a><a href="http://xmlrpcpp.sourceforge.net/" target="_blank" rel="external">XmlRpc++</a></h3><ul>
<li>是XML-RPC机制的C++实现，XmlRpc是远程过程调用的一种方式，不过更加简单一些，其使用XML作为数据交换格式，使用HTTP协议进行通信。</li>
<li>所有IO都是非阻塞式的，所以网络状态不佳也不会拖慢服务端</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/16/160816ROS中有用的模块/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          【ROS】ROS中其他有价值的模块
        
      </div>
    </a>
  
  
    <a href="/2016/08/16/160816ROS-Bag介绍/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">【ROS】rosbag-数据记录工具</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="160816-roscommon详解" data-title="【ROS】roscommon详解" data-url="https://ZhenshengLee.github.io/2016/08/16/160816-roscommon详解/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"zhenshenglee"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 黎振胜
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>